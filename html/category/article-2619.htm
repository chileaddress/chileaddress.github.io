<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
        <link rel="canonical" href="https://chileaddress.github.io/html/category/article-2619.htm" />
    <title>系统设计的11个考虑编程一生 - Chile Address</title>
        <link href="/assets/addons/xcblog/css/chileaddress/bootstrap.css" rel="stylesheet" type="text/css" media="all">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Custom Theme files -->
    <link href="/assets/addons/xcblog/css/chileaddress/style.css" rel="stylesheet" type="text/css" media="all" />
    <!-- Custom Theme files -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/assets/addons/xcblog/img/chileaddress/favicon.ico" type="image/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="application/x-javascript">
    addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);

    function hideURLbar() { window.scrollTo(0, 1); }
    </script>
    <!--Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,500,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Condensed' rel='stylesheet' type='text/css'>
    <!--google fonts-->
    <script src="/assets/addons/xcblog/js/frontend/chileaddress/jquery-1.11.0.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/chileaddress/bootstrap.min.js"></script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e311768eec030d1b95bf25adcc77f433";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body>
        <!--header-top start here-->
    <div class="top-header">
    </div>
    <!--header-top end here-->
    <!--header start here-->
    <!-- NAVBAR
		================================================== -->
    <div class="header w3l">
        <div class="fixed-header">
            <div class="navbar-wrapper">
                <div class="container">
                    <nav class="navbar navbar-inverse navbar-static-top">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <div class="logo">
                                                                <a class="navbar-brand" href="/">Chile Address</a>
                                                            </div>
                        </div>
                        <div id="navbar" class="navbar-collapse collapse">
                            <nav class="cl-effect-16" id="cl-effect-16">
                                <ul class="nav navbar-nav">
                                                                        <li>
                                        <a href="/">首页</a>
                                    </li>
                                                                        <li>
                                        <a href="/html/category/">文章分类</a>
                                    </li>
                                                                        <li>
                                        <a href="#">关于</a>
                                    </li>
                                    <li>
                                        <a href="#">联系</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="clearfix"> </div>
                    </nav>
                </div>
                <div class="clearfix"> </div>
            </div>
        </div>
    </div>
    <!--header end here-->
    <!--about strat here-->
    <div class="about">
        <div class="container">
            <div class="about-main">
                <div class="row">
                    <div class="col-md-9">
                        <ol class="breadcrumb">
                          <li><a href="/">首页</a></li>
                          <li><a href="/html/category/">文章分类</a></li>
                          <li class="active">正文</li>
                        </ol>
                        <div class="about-top">
                            <h1>系统设计的11个考虑编程一生</h1>
                        </div>
                        <div class="about-bottom">
                              				  				  				<p>有了《<strong>系统架构的11条原则</strong>》，真正到设计阶段还有另外11个考虑。</p> <p><strong>系统正确性</strong></p> <p><strong>考虑一：负负得正</strong></p> <p>假如我们看到某个代码，明显有逻辑错误，想随手改改。你就要考虑一件事情：这段明显有问题的代码为什么在线上运行着没有人来报bug？有一种正常运行叫做【<strong>负负得正</strong>】。如果把错误的逻辑改对了反而可能引起问题。</p> <p>这种问题要避免最好的时机是初版设计和开发阶段就避免。除了设计阶段逻辑要清晰，代码要做好审查、加上单体测试等测试手段外，可以将中间结果用debug日志打印。建议自测阶段多用debug级别日志跑几遍，进行观察。</p> <p><strong>考虑二：终态设计</strong></p> <p>在分布式系统中，由于系统是分布在不同机器上的。还可能有一种状态叫：超时。成功、失败和超时是<strong>分布式系统调用的三态</strong>。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/a962d01c6a2029f62f2243010849d9af.jpg" alt="系统设计的11个考虑编程一生 "></p> <p>超时不是终态，而是一种中间状态：最终有可能下游是成功了，也有可能是失败了。这时候我们需要在超时之后推定一种状态，推定成功或者失败。究竟是成功还是失败因功能而异。</p> <p>比如付款操作，需要推定失败。如果不知道是否成功就推定是成功的，那用户可能没有付款就拿到了商品或者享受了服务，商家就会资金损失。推定失败让用户再次支付，最终通过查询或者对账发现用户实际是支付成功的，可以再把钱给用户退回去，保证交易的公平性。</p> <p>退款恰恰相反，需要推定成功。告诉用户，钱退给你了。最终通过查询或者对账发现实际是退款失败了，可以系统重新发起退款，直到真正退成功为止。</p> <p>后台管理系统也很需要这种终态设计。比如发布系统，发布了一个功能，发布系统如果出现了问题，这次发布没有结束。用户可能没有办法进行下一次发布。这时候可以设置超时自动结束，防止未结束的流程始终在那里。</p> <p><strong>考虑三：</strong><strong>长尾效应</strong></p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/0f3f6b0174b59bffdc8a7fd3337a9836.jpg" alt="系统设计的11个考虑编程一生 "></p> <p>如上图，随便找了一个调用的耗时。从上面可以看到平均耗时13.9ms，百分之99的耗时在30ms内，最大耗时有488ms。那对于超过100ms的请求来说，是不是在30ms内还不返回就直接丢弃这个请求重新发起一个，新请求有99%的概率在30ms内返回结果，从时间上更划算？</p> <p>而之所以对同一个请求性能差距很大，原因很多，常见的有服务过载和队列过长。如果长尾处理不好，有可能上游判定超时，导致请求失败，影响正确性。需要系统处理好<strong>超时和重试</strong>。</p> <p><strong>系统容量</strong></p> <p><strong>考虑四：</strong><strong>存储周期</strong></p> <p>数据库、应用系统的磁盘都是宝贵的资源。数据不能无限期存储不做清理。清理的周期是一个重要的考虑方面。因为这涉及对用户的承诺。</p> <p>对数据库来说，比如交易库数据半年清理一次。那就要跟用户说清楚半年以上的交易不允许退款。因为原交易已经不在数据库，而是<strong>归档</strong>到大数据了。</p> <p>对磁盘来说，如果应用日志是30天清理一次。那就要跟用户达成一致，非重大问题30天以上的不予追溯。为什么这里说重大问题呢，其实很多公司磁盘清理了，数据在hbase等大数据设备里还是有留存的。只是查询没有磁盘日志便利。</p> <p><strong><strong>考虑五：</strong></strong><strong>AKF扩展</strong></p> <p><strong>AKF扩展立方体</strong><strong>（Scalability Cube）</strong>，是《<strong>架构即未来</strong>》一书中提出的可扩展模型，这个立方体有三个轴线，每个轴线描述扩展性的一个维度：</p> <p>X轴 —— 代表无差别的克隆服务和数据，工作可以很均匀的分散在不同的服务实例上；</p> <p>Y轴 —— 关注应用中职责的划分，比如数据类型，交易执行类型的划分；</p> <p>Z轴 —— 关注服务和数据的优先级划分，如分地域划分。</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/80bc2062a02d5021d823c23910032069.jpg" alt="系统设计的11个考虑编程一生 "></p> <p>白话来说：X轴拆分就是通过加机器水平拆分，就是横向扩展；Y轴拆分就是按业务逻辑垂直拆分；Z轴拆分就是按照算法进行分片，这个算法比如按地域，不同地域访问不同的分片或者服务。</p> <p>举个例子，比如一般公司的<strong>redis集群</strong>会有一个团队来进行统一维护。redis集群有主有从，数据都是一样的，多副本容灾，这是X轴水平的拆分。一个公司很多业务，redis团队会对不同的业务提供不同的集群，这是Y轴垂直拆分；集群内部数据会通过sharding做分片，这是Z轴算法拆分。</p> <p><strong>系统运维</strong></p> <p><strong>考虑六：服务自治</strong></p> <p>当一个服务的逻辑单元由自身的领域边界内所控制，不受其他外界条件的影响（外界条件带有不可预测性），且运行环境是自身可控，完全自给自足，我们认为这个<strong>服务是自治</strong>的。</p> <p>在系统设计时，要考虑服务上线后，对于问题要自感知、自修复、自优化、自运维及自安全。</p> <p><strong>考虑七：应急预案</strong></p> <p data-pid="K7xAw8hB"><strong>SOP</strong>（Standard Operating Procedure三个单词中首字母的大写 ）即标准作业程序，就是将某一事件的标准操作步骤和要求以统一的格式描述出来，用来指导和规范日常的工作。</p> <p data-pid="K7xAw8hB"> <p data-pid="ngxOZYlU"><strong>EOP</strong>（Emergency Operating Procedure三个单词中首字母的大写 ）即应急操作流程，用于规范应急操作过程中的流程及操作步骤。确保人员可以迅速启动，确保有序、有效地组织实施各项应对措施。</p> <p data-pid="ngxOZYlU"> <p data-pid="ngxOZYlU">这两种操作流程需要平时就整理好，避免紧急情况下思虑不周导致操作时的二次故障。</p> <p><strong>考虑八：故障隔离</strong></p> <p>隔离是行之有效的故障规避措施。有以下隔离手段。</p> <ul class="list-paddingleft-1"> <li> <p>领域拆分隔离方面</p> </li> <ul class="list-paddingleft-1"> <li> <p><strong>ACL防止损坏层</strong></p> </li> <li> <p><strong>有界上下文</strong></p> </li> <li> <p>提炼核心、支撑和通用域</p> </li> <li> <p><strong>分层架构</strong></p> </li> <li> <p><strong>CRUD增删改查简单架构</strong></p> </li> <li> <p><strong>CQRS命令查询隔离</strong></p> </li> <li> <p><strong>依赖消弱控</strong></p> </li> </ul> <li> <p>服务部署隔离方面</p> </li> <ul class="list-paddingleft-1"> <li> <p>环境拆分</p> </li> <li> <p>机房隔离</p> </li> <li> <p>通道隔离</p> </li> <li> <p>单元化</p> </li> <li> <p>泳道</p> </li> <li> <p>热点隔离</p> </li> <li> <p>读写隔离</p> </li> <li> <p>容器隔离</p> </li> <li> <p>拆库拆表</p> </li> <li> <p>动静隔离</p> </li> <li> <p>非核心流量隔离</p> </li> </ul> <li> <p>服务间交互隔离方面</p> </li> <ul class="list-paddingleft-1"> <li> <p><strong>超时熔断</strong></p> </li> <li> <p>失败率超限降级</p> </li> <li> <p>服务内资源隔离方面</p> </li> <li> <p><strong>线程池隔离</strong></p> </li> <li> <p>信号量隔离</p> </li> </ul> </ul> <p><strong>考虑九：风险巡检</strong></p> <p>核心系统稳定之后，更多的从边缘进行优化，避免影响核心系统的稳定。风险巡检是优化的重要方面。常见的有以下内容。</p> <ul class="list-paddingleft-1"> <li> <p>请求系统错误统计</p> </li> <li> <p>请求业务错误统计</p> </li> <li> <p>请求内部错误统计</p> </li> <li> <p>慢查询统计巡检</p> </li> <li> <p>数据一致性巡检</p> </li> <li> <p>流程执行情况巡检</p> </li> </ul> <p><strong>审计和安全</strong></p> <p><strong>考虑十：合法合规</strong></p> <p><strong>合法合规</strong>是企业生死存亡的大事。近年来，由于政策影响，很多教育机构面临了巨大的危机甚至倒闭。</p> <p>对于金融类企业，太多合规操作。比如：行业要求金融交易类系统不能与其他系统混合部署；平台没有清结算资质可能面临二清问题。提到资质，不得不说说金融牌照。在我国，需要审批的金融牌照主要包括银行、信托、保险、券商、期货、基金、基金子公司、基金销售、金融租赁、小额贷款、第三方支付牌照、典当12种。业务的牌照要对口。</p> <p><strong>考虑十一：严格准入</strong></p> <p>做需求有个常识，对于用户输入的每个字段都需要和产品经理讨论一下：什么类型、长度多少、允许的字符集范围、格式是否合法。这么做一方面是设计问题，包括产品设计、数据库设计，还有一部分是安全问题：一个数值型的字段肯定比一个粗放的文本型字段被攻击的可能性小，起码不会传到后端之后被当成脚本被执行。</p> <p><strong>操作合理性准入</strong>也是考虑的重要方面。比如一个普通用户不能编辑另一个用户的个人信息。比如i申请公司服务器，一次申请1万台机器。比如流量准入，一台机器以超快的速度频繁访问一个网站的资讯信息，就可能不是真实用户操作而是爬虫。以上都会对系统安全性产生极大的影响。</p> <p><strong>总结</strong></p> <p>一张图总结今天的内容：</p> <p><img decoding="async" src="http://img.555519.xyz/uploads3/20220509/5c506aef83b4da4831ae53629796de28.jpg" alt="系统设计的11个考虑编程一生 "></p> 			                            <div class="clearfix"> </div>
                        </div>

                        <div class="col-md-12 mt-5">
                                                        <p>上一个：<a href="/html/category/article-2618.htm">springboot整合微信支付过程详解（附源码，亲测可用）</a></p>
                                                        <p>下一个：<a href="/html/category/article-2620.htm">HBase原理和基本架构和HBase优化（包括RowKey设计）</a></p>
                                                    </div>

                                            </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-6587.htm" title="瑞丽旅游景点大全(瑞丽旅游攻略必去景点推荐)">瑞丽旅游景点大全(瑞丽旅游攻略必去景点推荐)</a></li>
                        <li class="py-2"><a href="/html/category/article-6863.htm" title="猫三针疫苗多少钱（猫咪防疫针多少钱）">猫三针疫苗多少钱（猫咪防疫针多少钱）</a></li>
                        <li class="py-2"><a href="/html/category/article-7276.htm" title="去宠物医院绝育会不会被感染（去宠物医院绝育会不会被感染艾滋病）">去宠物医院绝育会不会被感染（去宠物医院绝育会不会被感染艾滋病）</a></li>
                        <li class="py-2"><a href="/html/category/article-6632.htm" title="青岛南京路动物防疫站宠物医院（青岛动物疫病防治中心南京路305号电话）">青岛南京路动物防疫站宠物医院（青岛动物疫病防治中心南京路305号电话）</a></li>
                        <li class="py-2"><a href="/html/category/article-7414.htm" title="广州宠物领养站 广州宠物领养站地址">广州宠物领养站 广州宠物领养站地址</a></li>
                        <li class="py-2"><a href="/html/category/article-6167.htm" title="狗粮颗粒机器价格及图片大全（狗粮颗粒机 家用小型）">狗粮颗粒机器价格及图片大全（狗粮颗粒机 家用小型）</a></li>
                        <li class="py-2"><a href="/html/category/article-6166.htm" title="动物医院申请条件及流程怎么写范文图片（动物医院申请条件及流程怎么写范文图片大全）">动物医院申请条件及流程怎么写范文图片（动物医院申请条件及流程怎么写范文图片大全）</a></li>
                        <li class="py-2"><a href="/html/category/article-6770.htm" title="北京中农大动物医院有限公司招聘信息（北京中农大动物药业官网）">北京中农大动物医院有限公司招聘信息（北京中农大动物药业官网）</a></li>
                        <li class="py-2"><a href="/html/category/article-7599.htm" title="哪里可以领养宠物狗狗（哪里可以领养宠物狗狗呢）">哪里可以领养宠物狗狗（哪里可以领养宠物狗狗呢）</a></li>
                        <li class="py-2"><a href="/html/category/article-7277.htm" title="新手怎么联系厂家进货没有电话（怎样联系厂家拿到最便宜的货）">新手怎么联系厂家进货没有电话（怎样联系厂家拿到最便宜的货）</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">26</span> <a href="/html/date/2024-08/" title="2024-08 归档">2024-08</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-07/" title="2024-07 归档">2024-07</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">44</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>


                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--about end here-->
        <!--copy rights start here-->
    <div class="copy-rights">
        <div class="container">
            <div class="copy-rights-main">
                <p>
                    Chile Address 版权所有
                    <br />
                    Powered by WordPress
                </p>
            </div>
        </div>
    </div>
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>