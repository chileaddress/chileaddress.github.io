<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
        <link rel="canonical" href="https://chileaddress.github.io/html/category/article-2651.htm" />
    <title>Spirngboot实现Nacos作为配置中心_在线工具 - Chile Address</title>
        <link href="/assets/addons/xcblog/css/chileaddress/bootstrap.css" rel="stylesheet" type="text/css" media="all">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- Custom Theme files -->
    <link href="/assets/addons/xcblog/css/chileaddress/style.css" rel="stylesheet" type="text/css" media="all" />
    <!-- Custom Theme files -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/assets/addons/xcblog/img/chileaddress/favicon.ico" type="image/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="application/x-javascript">
    addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);

    function hideURLbar() { window.scrollTo(0, 1); }
    </script>
    <!--Google Fonts-->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,500,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu+Condensed' rel='stylesheet' type='text/css'>
    <!--google fonts-->
    <script src="/assets/addons/xcblog/js/frontend/chileaddress/jquery-1.11.0.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/chileaddress/bootstrap.min.js"></script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e311768eec030d1b95bf25adcc77f433";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body>
        <!--header-top start here-->
    <div class="top-header">
    </div>
    <!--header-top end here-->
    <!--header start here-->
    <!-- NAVBAR
		================================================== -->
    <div class="header w3l">
        <div class="fixed-header">
            <div class="navbar-wrapper">
                <div class="container">
                    <nav class="navbar navbar-inverse navbar-static-top">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <div class="logo">
                                                                <a class="navbar-brand" href="/">Chile Address</a>
                                                            </div>
                        </div>
                        <div id="navbar" class="navbar-collapse collapse">
                            <nav class="cl-effect-16" id="cl-effect-16">
                                <ul class="nav navbar-nav">
                                                                        <li>
                                        <a href="/">首页</a>
                                    </li>
                                                                        <li>
                                        <a href="/html/category/">文章分类</a>
                                    </li>
                                                                        <li>
                                        <a href="#">关于</a>
                                    </li>
                                    <li>
                                        <a href="#">联系</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="clearfix"> </div>
                    </nav>
                </div>
                <div class="clearfix"> </div>
            </div>
        </div>
    </div>
    <!--header end here-->
    <!--about strat here-->
    <div class="about">
        <div class="container">
            <div class="about-main">
                <div class="row">
                    <div class="col-md-9">
                        <ol class="breadcrumb">
                          <li><a href="/">首页</a></li>
                          <li><a href="/html/category/">文章分类</a></li>
                          <li class="active">正文</li>
                        </ol>
                        <div class="about-top">
                            <h1>Spirngboot实现Nacos作为配置中心_在线工具</h1>
                        </div>
                        <div class="about-bottom">
                              				  				  				<h2><span style='font-family: "comic sans ms", sans-serif'>一、Nacos（Nacos官方文档）</span></h2> <p><span style='font-family: "comic sans ms", sans-serif'>Nacos是阿里旗下的一款开源软件，支持服务注册与发现、配置管理以及微服务管理的组件。Nacos的目标是为了取代过去常用的注册中心（Zookeeper、Eureka等），以及配置中心（Spring Cloud Config等）。Nacos集成了注册中心和配置中心的功能。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>基于此，虽然是SpirngBoot项目，服务注册与发现用不上，但是可以使用Nacos配置中心的功能，对项目的配置文件进行动态管理。</span></p> <h2><span style='font-family: "comic sans ms", sans-serif'>二、nacos依赖</span></h2> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><!-- nacos配置中心依赖 --> <dependency>     <groupId>com.alibaba.cloud</groupId>     spring-cloud-starter-alibaba-nacos-config</artifactId> </dependency><span style="color: rgba(0, 0, 0, 1)">  springcloud相关依赖如下： </span><!-- spring-cloud-alibaba依赖库 --> <dependency>    <groupId>com.alibaba.cloud</groupId>    <artifactId>spring-cloud-alibaba-dependencies</artifactId>    <version>${spring-cloud-alibaba.version}</version>    <type>pom</type>    <scope><span style="color: rgba(0, 0, 255, 1)">import</span></scope> </dependency></span></pre> <pre><span style='font-family: "comic sans ms", sans-serif'><spring-cloud-alibaba.version>2.2.6.RELEASE</spring-cloud-alibaba.version></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'>注意：springcloud-alibaba依赖版本需和nacos版本对应。（<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"  target="_blank"  rel="nofollow">版本对应关系）</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>附：</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>注册中心依赖如下：</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><dependency>     <groupId>com.alibaba.cloud</groupId>     spring-cloud-starter-alibaba-nacos-discovery</artifactId> </dependency></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'> 注意：查询资料时发现有如下问题：</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>SpringBoot项目bootstrap.yml配置文件不加载：</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>bootstrap.yml需要引入springcloud的包才会加载。</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><dependency>      <groupId>org.springframework.cloud</groupId>      <artifactId>spring-cloud-context</artifactId>      <version>${spring-cloud-context.version}</version>  </dependency></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'>此问题我并没有遇到，如遇到此问题可按如上方式进行尝试解决。</span></p> <h2><span style='font-family: "comic sans ms", sans-serif'>三、Nacos搭建</span></h2> <p><span style='font-family: "comic sans ms", sans-serif'>1、Nacos下载。去到官网下载各个版本的压缩包。<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://github.com/alibaba/nacos/releases"  target="_blank"  rel="nofollow">下载地址。我用的是1.4.2版本。最新版本目前为2.0.3。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>　  本地：下载.zip文件解压到本地使用。Linux：下载.tar.gz文件部署到Linux环境解压使用。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>　  如何启动Nacos服务查询官方文档。上面都有说明。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>2、搭建测试环境集群。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>首先建立三台测试服务器。如192.168.1.1，192.168.1.2， 192.168.1.3。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>先将下载好的nacos-server-1.4.2.tar.gz文件上传到三台测试服务器上。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>unzip nacos-server-1.3.0.zip 或者 tar -xvf nacos-server-1.3.0.tar.gz解压上传的压缩文件。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>解压之后，进到conf文件夹下，有一个cluster.conf.example文件。可以cp cluster.conf.example cluster.conf将原文件备份保存，然后创建一个新的cluster.conf文件使用。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>ps：此处如不做备份，则使用cluster.conf文件需要将原来的.example后缀删除使用.conf文件。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>cat cluster.conf命令查看此文件，在此文件中，请每行配置成ip:port形式。如：</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><span style="color: rgba(0, 0, 0, 1)"># ip:port </span>192.168.1.1:8848 192.168.1.2:8848 192.168.1.3:8848</span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'>3、启动服务器。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>启动服务器之前还有一步操作，需要执行一个使用外置数据源的sql脚本，此脚本在下载的nacos压缩包中自带，直接建立数据库执行就好。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>执行脚本结束后，需要修改conf文件夹下的application.properties配置文件。放开如下注释。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/bf8fda6b489d1acf9d46faa33f420525.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'> 修改mysql数据库配置。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>此时直接执行sh.startup.sh启动命令会报如下错误。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/573892141f69b72a897170a0e8247774.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'>解决方案。用vi命令配置jdk。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/2876cd94f4f349f952c953fc3e76f91f.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'>此时配置添加完成，执行启动命令，执行成功。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>4、相关配置。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/7996c783920c9c90cbcb10a79e168a4b.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'> 下载下来的nacos默认此处为false。我们要将此处权限修改为true。如果为false则登录nacos时无需验证用户名和密码。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/a3a56f24d021df7346800ba367e90350.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'>此处可以配置为false。nacos增长的日志太快，且有大部分是无效日志。如需要则打开。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>Nacos集群部署完成。登录格式：域名+/nacos 登录。管理员用户名密码默认都为nacos。进入可视化界面可进行修改。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>ps:发现一篇讲解更详细的博文。戳。</span></p> <h2><span style='font-family: "comic sans ms", sans-serif'>四、代码配置</span></h2> <p><span style='font-family: "comic sans ms", sans-serif'>本项目结构如图。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/5b45a59b69972009f4264dde64da9e43.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'> 在父依赖中配置profiles做环境区分。</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><!--开发环境-->         <profile>             <id>dev</id>             <properties>                 <profileActive>dev</profileActive>                 <profileActiveNacosServerAddr>192.168.1.1:8848,192.168.1.2:8848,192.168.1.3:8848</profileActiveNacosServerAddr>                 <profileNacosNameSpace>lmes-dev</profileNacosNameSpace>                 <profileNacosConfigNameSpace>生成的namespaceid</profileNacosConfigNameSpace>                 <profileNacosUsername>用户名</profileNacosUsername>                 <profileNacosPassword>密码</profileNacosPassword>             </properties>             <activation>                 <activeByDefault><span style="color: rgba(0, 0, 255, 1)">true</span></activeByDefault>             </activation>         </profile></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'>每个服务中需添加bootstrap.yml文件。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/14e085602e4e3a7c6781924240d6d8cb.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p><span style='font-family: "comic sans ms", sans-serif'> 配置如下：</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><span style="color: rgba(0, 0, 0, 1)">spring:   application: #微服务名称     name: lmes</span>-<span style="color: rgba(0, 0, 0, 1)">agentmanagement   main:     allow</span>-bean-definition-overriding: <span style="color: rgba(0, 0, 255, 1)">true   -----不知道干啥的 之后有需要可进行分析</span><span style="color: rgba(0, 0, 0, 1)">   cloud:     nacos:       username: @profileNacosUsername@       password: @profileNacosPassword@       # nacos配置中心配置       config:         server</span>-<span style="color: rgba(0, 0, 0, 1)">addr: @profileActiveNacosServerAddr@         file</span>-<span style="color: rgba(0, 0, 0, 1)">extension: yml         group: @profileActive@         namespace: @profileNacosConfigNameSpace@         extension</span>-<span style="color: rgba(0, 0, 0, 1)">configs:           </span>- data-id: lmes-<span style="color: rgba(0, 0, 0, 1)">agentmanagement             group: @profileActive@             refresh: </span><span style="color: rgba(0, 0, 255, 1)">true</span></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'> 父依赖pom文件中还需要添加如下配置：</span></p> <div class="cnblogs_code"> <pre><span style='font-family: "comic sans ms", sans-serif'><build>         <resources>             <resource>                 <filtering><span style="color: rgba(0, 0, 255, 1)">true</span></filtering>    ----- true表示文件中可以获取到pom文件中的配置。                 <directory>src/main/resources</directory>  -----作用域到这个文件夹下面的文件                 <excludes>                     <exclude>config/application*.yml</exclude>  -----exclude排除某些文件  include包括某些文件                 </excludes>             </resource>         </resources>         <plugins>             <plugin>                 <groupId>org.springframework.boot</groupId>                 <artifactId>spring-boot-maven-plugin</artifactId>                 <configuration>                     <layout>JAR</layout>                     <finalName>${project.name}-server</finalName>                     <outputDirectory>../install/servers/${project.artifactId}</outputDirectory>                 </configuration>                 <executions>                     <execution>                         <goals>                             <goal>repackage</goal>                         </goals>                     </execution>                 </executions>             </plugin>         </plugins>     </build></span></pre> </div> <p><span style='font-family: "comic sans ms", sans-serif'>检测bootstrap.yml文件有没有成功加载pml文件中配置的数据：</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>idea----clean----install</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>去看项目中target下的bootstrap有没有印上相应的值。</span></p> <h2><span style='font-family: "comic sans ms", sans-serif'>五、发布测试环境</span></h2> <p><span style='font-family: "comic sans ms", sans-serif'>打包成功后会在install中生成对应服务的jar包。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>把生成的jar包放到对应的服务器上。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>操作MobaXterm。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>先进入到对应的服务器，ps -ef| grep java 查看存活线程。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>找到对应的服务进入到对应目录下面。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'><img decoding="async" src="http://img.555519.xyz/uploads3/20220501/6f726a3aab920e0199fed5a08e7fad97.jpg" alt="Spirngboot实现Nacos作为配置中心_在线工具"></span></p> <p> </p> <p><span style='font-family: "comic sans ms", sans-serif'> 找到启动文件。cat查看启动文件。没有kill命令需要执行 kill -9 命令杀掉线程重新发布。 启动文件中可能会有$1 $2 这种参数，需注意。</span></p> <p><span style='font-family: "comic sans ms", sans-serif'>至此，nacos配置中心部署完成。</span></p> 			                            <div class="clearfix"> </div>
                        </div>

                        <div class="col-md-12 mt-5">
                                                        <p>上一个：<a href="/html/category/article-2650.htm">PyCharm 2020.1启动报错 Caused by: java.net.BindException: Address already in use: bind</a></p>
                                                        <p>下一个：<a href="/html/category/article-2652.htm">Citus 分布式 PostgreSQL 集群 &#8211; SQL Reference(查询分布式表 SQL)</a></p>
                                                    </div>

                                            </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-6954.htm" title="天恩宠物医院（天恩宠物医院怎么样）">天恩宠物医院（天恩宠物医院怎么样）</a></li>
                        <li class="py-2"><a href="/html/category/article-7184.htm" title="葫芦岛领养狗狗（葫芦岛领养狗狗电话）">葫芦岛领养狗狗（葫芦岛领养狗狗电话）</a></li>
                        <li class="py-2"><a href="/html/category/article-7001.htm" title="被猫抓了一下挤出一点血（被猫抓了一下挤出一点血有事吗）">被猫抓了一下挤出一点血（被猫抓了一下挤出一点血有事吗）</a></li>
                        <li class="py-2"><a href="/html/category/article-7599.htm" title="哪里可以领养宠物狗狗（哪里可以领养宠物狗狗呢）">哪里可以领养宠物狗狗（哪里可以领养宠物狗狗呢）</a></li>
                        <li class="py-2"><a href="/html/category/article-6725.htm" title="学宠物医生上什么学校比较好（学宠物医生这样的专业好不好）">学宠物医生上什么学校比较好（学宠物医生这样的专业好不好）</a></li>
                        <li class="py-2"><a href="/html/category/article-6863.htm" title="猫三针疫苗多少钱（猫咪防疫针多少钱）">猫三针疫苗多少钱（猫咪防疫针多少钱）</a></li>
                        <li class="py-2"><a href="/html/category/article-6955.htm" title="2021年春节旅游景点(2021年春节期间旅游景点)">2021年春节旅游景点(2021年春节期间旅游景点)</a></li>
                        <li class="py-2"><a href="/html/category/article-6678.htm" title="同城免费领养宠物可靠吗知乎 同城免费领养宠物可靠吗知乎文章">同城免费领养宠物可靠吗知乎 同城免费领养宠物可靠吗知乎文章</a></li>
                        <li class="py-2"><a href="/html/category/article-7368.htm" title="专门买宠物的APP（专门买宠物的软件）">专门买宠物的APP（专门买宠物的软件）</a></li>
                        <li class="py-2"><a href="/html/category/article-7092.htm" title="免费领养宠物的app下载安装（免费领养宠物的app下载安装）">免费领养宠物的app下载安装（免费领养宠物的app下载安装）</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">24</span> <a href="/html/date/2024-08/" title="2024-08 归档">2024-08</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-07/" title="2024-07 归档">2024-07</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">44</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>


                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--about end here-->
        <!--copy rights start here-->
    <div class="copy-rights">
        <div class="container">
            <div class="copy-rights-main">
                <p>
                    Chile Address 版权所有
                    <br />
                    Powered by WordPress
                </p>
            </div>
        </div>
    </div>
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>